generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model roles {
  rol_id        Int             @id @default(autoincrement()) @db.UnsignedInt
  nombre        String          @unique(map: "nombre") @db.VarChar(50)
  usuario_roles usuario_roles[]
}

model complexivo_asistencias {
  complexivo_asistencia_id Int                           @id @default(autoincrement()) @db.UnsignedInt
  materia_id               Int                           @db.UnsignedInt
  estudiante_id            Int                           @db.UnsignedInt
  fecha                    DateTime                      @db.Date
  estado                   complexivo_asistencias_estado
  complexivo_materias      complexivo_materias           @relation(fields: [materia_id], references: [complexivo_materia_id], onUpdate: Restrict, map: "fk_asist_materia")

  @@unique([materia_id, estudiante_id, fecha], map: "uq_asistencia")
  @@index([materia_id], map: "idx_asist_materia")
}

model complexivo_materias {
  complexivo_materia_id  Int                      @id @default(autoincrement()) @db.UnsignedInt
  periodo_id             Int                      @db.UnsignedInt
  carrera_id             Int                      @db.UnsignedInt
  codigo                 String                   @db.VarChar(30)
  nombre                 String                   @db.VarChar(150)
  docente_usuario_id     Int                      @db.UnsignedInt
  creado_en              DateTime                 @default(now()) @db.DateTime(0)
  complexivo_asistencias complexivo_asistencias[]
  usuarios               usuarios                 @relation(fields: [docente_usuario_id], references: [usuario_id], onUpdate: Restrict, map: "fk_compmat_doc")
  periodos               periodos                 @relation(fields: [periodo_id], references: [periodo_id], onUpdate: Restrict, map: "fk_compmat_per")

  @@unique([periodo_id, carrera_id, codigo], map: "uq_comp_materia")
  @@index([docente_usuario_id], map: "idx_comp_doc")
  @@index([carrera_id, periodo_id], map: "idx_comp_mat")
}

model cronograma_items {
  cronograma_item_id Int         @id @default(autoincrement()) @db.UnsignedInt
  cronograma_id      Int         @db.UnsignedInt
  titulo             String      @db.Text
  fecha_inicio       DateTime    @db.DateTime(0)
  fecha_fin          DateTime    @db.DateTime(0)
  descripcion        String?     @db.Text
  cronogramas        cronogramas @relation(fields: [cronograma_id], references: [cronograma_id], onUpdate: Restrict, map: "fk_croni_cron")

  @@index([cronograma_id], map: "idx_croni_cron")
}

model cronogramas {
  cronograma_id    Int                   @id @default(autoincrement()) @db.UnsignedInt
  periodo_id       Int                   @db.UnsignedInt
  modalidad        cronogramas_modalidad
  publicado        Boolean               @default(false)
  creado_por       Int?                  @db.UnsignedInt
  creado_en        DateTime              @default(now()) @db.DateTime(0)
  cronograma_items cronograma_items[]
  periodos         periodos              @relation(fields: [periodo_id], references: [periodo_id], onUpdate: Restrict, map: "fk_cron_periodo")
  usuarios         usuarios?             @relation(fields: [creado_por], references: [usuario_id], onUpdate: Restrict, map: "fk_cron_usuario")

  @@index([creado_por], map: "idx_cron_creado")
  @@index([periodo_id], map: "idx_cron_periodo")
}

model documentos {
  documento_id          Int                     @id @default(autoincrement()) @db.UnsignedInt
  usuario_id            Int?                    @db.UnsignedInt
  estudiante_id         Int?                    @db.UnsignedInt
  tipo                  documentos_tipo
  nombre_archivo        String                  @db.VarChar(255)
  ruta_archivo          String                  @db.VarChar(500)
  mime_type             String?                 @db.VarChar(100)
  pago_referencia       String?                 @db.VarChar(100)
  pago_monto            Decimal?                @db.Decimal(10, 2)
  observacion           String?                 @db.VarChar(500)
  creado_en             DateTime                @default(now()) @db.DateTime(0)
  estado                documentos_estado       @default(en_revision)
  usuarios              usuarios?               @relation(fields: [usuario_id], references: [usuario_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_doc_usuario")
  modalidades_elegidas  modalidades_elegidas[]
  procesos_validaciones procesos_validaciones[]
  uic_asignaciones      uic_asignaciones[]

  @@index([estudiante_id, tipo], map: "idx_doc_estudiante_tipo")
  @@index([tipo, creado_en], map: "idx_doc_tipo_fecha")
  @@index([usuario_id], map: "idx_doc_usuario")
}

model modalidades_elegidas {
  modalidad_elegida_id Int                            @id @default(autoincrement()) @db.UnsignedInt
  periodo_id           Int                            @db.UnsignedInt
  estudiante_id        Int                            @db.UnsignedInt
  carrera_id           Int                            @db.UnsignedInt
  modalidad            modalidades_elegidas_modalidad
  comprobante_doc_id   Int?                           @db.UnsignedInt
  creado_en            DateTime                       @default(now()) @db.DateTime(0)
  documentos           documentos?                    @relation(fields: [comprobante_doc_id], references: [documento_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_mod_comprobante_doc")
  periodos             periodos                       @relation(fields: [periodo_id], references: [periodo_id], onUpdate: Restrict, map: "fk_mod_per")

  @@index([comprobante_doc_id], map: "fk_mod_comprobante_doc")
  @@index([estudiante_id, periodo_id], map: "idx_mod_est")
  @@index([periodo_id], map: "idx_mod_periodo")
}

model notificaciones {
  notificacion_id         Int       @id @default(autoincrement()) @db.UnsignedInt
  titulo                  String    @db.VarChar(150)
  cuerpo                  String    @db.Text
  destinatario_usuario_id Int?      @db.UnsignedInt
  destinatario_rol        String?   @db.VarChar(50)
  leida                   Boolean   @default(false)
  creado_en               DateTime  @default(now()) @db.DateTime(0)
  usuarios                usuarios? @relation(fields: [destinatario_usuario_id], references: [usuario_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_notif_user")

  @@index([destinatario_rol], map: "idx_notif_dest_rol")
  @@index([destinatario_usuario_id], map: "idx_notif_dest_usuario")
}

model periodos {
  periodo_id            Int                     @id @default(autoincrement()) @db.UnsignedInt
  nombre                String                  @db.VarChar(80)
  fecha_inicio          DateTime                @db.Date
  fecha_fin             DateTime                @db.Date
  estado                periodos_estado         @default(inactivo)
  creado_en             DateTime                @default(now()) @db.DateTime(0)
  academic_grades       academic_grades[]
  complexivo_materias   complexivo_materias[]
  cronogramas           cronogramas[]
  modalidades_elegidas  modalidades_elegidas[]
  procesos_validaciones procesos_validaciones[]
  uic_asignaciones      uic_asignaciones[]
  uic_topics            uic_topics[]
  veedor_assignments    veedor_assignments[]
}

model procesos_validaciones {
  proceso_validacion_id Int                           @id @default(autoincrement()) @db.UnsignedInt
  proceso               procesos_validaciones_proceso
  periodo_id            Int                           @db.UnsignedInt
  estudiante_id         Int                           @db.UnsignedInt
  estado                procesos_validaciones_estado  @default(pending)
  observacion           String?                       @db.VarChar(500)
  certificado_doc_id    Int?                          @db.UnsignedInt
  actualizado_en        DateTime                      @default(now()) @db.DateTime(0)
  documentos            documentos?                   @relation(fields: [certificado_doc_id], references: [documento_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_proc_cert")
  periodos              periodos                      @relation(fields: [periodo_id], references: [periodo_id], onUpdate: Restrict, map: "fk_proc_per")

  @@unique([proceso, periodo_id, estudiante_id], map: "uq_proc_est")
  @@index([certificado_doc_id], map: "fk_proc_cert")
  @@index([periodo_id, estudiante_id], map: "idx_proc_per_est")
  @@index([proceso, estado], map: "idx_proc_valid")
}

model uic_asignaciones {
  uic_asignacion_id                                     Int                     @id @default(autoincrement()) @db.UnsignedInt
  periodo_id                                            Int                     @db.UnsignedInt
  estudiante_id                                         Int                     @db.UnsignedInt
  carrera_id                                            Int                     @db.UnsignedInt
  tutor_usuario_id                                      Int?                    @db.UnsignedInt
  lector_usuario_id                                     Int?                    @db.UnsignedInt
  nota_tribunal                                         Decimal?                @db.Decimal(5, 2)
  acta_doc_id                                           Int?                    @db.UnsignedInt
  creado_en                                             DateTime                @default(now()) @db.DateTime(0)
  lector_nota                                           Decimal?                @db.Decimal(5, 2)
  lector_observacion                                    String?                 @db.VarChar(500)
  documentos                                            documentos?             @relation(fields: [acta_doc_id], references: [documento_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_uic_acta_doc")
  usuarios_uic_asignaciones_lector_usuario_idTousuarios usuarios?               @relation("uic_asignaciones_lector_usuario_idTousuarios", fields: [lector_usuario_id], references: [usuario_id], onUpdate: Restrict, map: "fk_uic_lector")
  periodos                                              periodos                @relation(fields: [periodo_id], references: [periodo_id], onUpdate: Restrict, map: "fk_uic_per")
  usuarios_uic_asignaciones_tutor_usuario_idTousuarios  usuarios?               @relation("uic_asignaciones_tutor_usuario_idTousuarios", fields: [tutor_usuario_id], references: [usuario_id], onUpdate: Restrict, map: "fk_uic_tutor")
  uic_tribunal_miembros                                 uic_tribunal_miembros[]
  uic_tutor_notas                                       uic_tutor_notas[]

  @@unique([periodo_id, estudiante_id], map: "uq_uic_estudiante_periodo")
  @@index([acta_doc_id], map: "fk_uic_acta_doc")
  @@index([estudiante_id, periodo_id], map: "idx_uic_est")
  @@index([lector_usuario_id], map: "idx_uic_lector")
  @@index([periodo_id], map: "idx_uic_periodo")
  @@index([tutor_usuario_id], map: "idx_uic_tutor")
}

model uic_tribunal_miembros {
  uic_tribunal_miembro_id Int                                @id @default(autoincrement()) @db.UnsignedInt
  uic_asignacion_id       Int                                @db.UnsignedInt
  docente_usuario_id      Int                                @db.UnsignedInt
  rol_tribunal            uic_tribunal_miembros_rol_tribunal
  uic_asignaciones        uic_asignaciones                   @relation(fields: [uic_asignacion_id], references: [uic_asignacion_id], onUpdate: Restrict, map: "fk_uictrib_asig")
  usuarios                usuarios                           @relation(fields: [docente_usuario_id], references: [usuario_id], onUpdate: Restrict, map: "fk_uictrib_doc")

  @@index([docente_usuario_id], map: "fk_uictrib_doc")
  @@index([uic_asignacion_id], map: "idx_uictrib_asig")
}

model uic_tutor_notas {
  uic_tutor_nota_id Int              @id @default(autoincrement()) @db.UnsignedInt
  uic_asignacion_id Int              @db.UnsignedInt
  parcial           Int              @db.UnsignedTinyInt
  nota              Decimal          @db.Decimal(5, 2)
  observacion       String?          @db.VarChar(500)
  fecha_registro    DateTime         @default(now()) @db.DateTime(0)
  uic_asignaciones  uic_asignaciones @relation(fields: [uic_asignacion_id], references: [uic_asignacion_id], onUpdate: Restrict, map: "fk_uicnota_asig")

  @@unique([uic_asignacion_id, parcial], map: "uq_uicnota")
}

model usuario_roles {
  usuario_id Int      @db.UnsignedInt
  rol_id     Int      @db.UnsignedInt
  roles      roles    @relation(fields: [rol_id], references: [rol_id], onUpdate: Restrict, map: "fk_ur_rol")
  usuarios   usuarios @relation(fields: [usuario_id], references: [usuario_id], onUpdate: Restrict, map: "fk_ur_usuario")

  @@id([usuario_id, rol_id])
  @@index([rol_id], map: "fk_ur_rol")
}

model usuarios {
  usuario_id                                                    Int                     @id @default(autoincrement()) @db.UnsignedInt
  nombre                                                        String                  @unique(map: "nombre") @db.VarChar(150)
  apellido                                                      String                  @db.VarChar(150)
  correo                                                        String?                 @db.VarChar(150)
  contrase_a_hash                                               String?                 @map("contrase√±a_hash") @db.VarChar(255)
  activo                                                        Boolean                 @default(true)
  creado_en                                                     DateTime                @default(now()) @db.DateTime(0)
  academic_grades_academic_grades_id_userTousuarios             academic_grades[]       @relation("academic_grades_id_userTousuarios")
  academic_grades_academic_grades_validated_byTousuarios        academic_grades[]       @relation("academic_grades_validated_byTousuarios")
  complexivo_materias                                           complexivo_materias[]
  cronogramas                                                   cronogramas[]
  documentos                                                    documentos[]
  notificaciones                                                notificaciones[]
  uic_asignaciones_uic_asignaciones_lector_usuario_idTousuarios uic_asignaciones[]      @relation("uic_asignaciones_lector_usuario_idTousuarios")
  uic_asignaciones_uic_asignaciones_tutor_usuario_idTousuarios  uic_asignaciones[]      @relation("uic_asignaciones_tutor_usuario_idTousuarios")
  uic_topics_uic_topics_id_tutorTousuarios                      uic_topics[]            @relation("uic_topics_id_tutorTousuarios")
  uic_topics_uic_topics_id_userTousuarios                       uic_topics[]            @relation("uic_topics_id_userTousuarios")
  uic_tribunal_miembros                                         uic_tribunal_miembros[]
  usuario_roles                                                 usuario_roles[]
  veedor_assignments                                            veedor_assignments[]
}

model academic_grades {
  grade_id                                        Int                    @id @default(autoincrement()) @db.UnsignedInt
  module                                          academic_grades_module
  id_user                                         Int                    @db.UnsignedInt
  id_academic_periods                             Int                    @db.UnsignedInt
  score                                           Decimal?               @db.Decimal(5, 2)
  status                                          academic_grades_status @default(saved)
  validated_by                                    Int?                   @db.UnsignedInt
  validated_at                                    DateTime?              @db.DateTime(0)
  created_at                                      DateTime               @default(now()) @db.DateTime(0)
  updated_at                                      DateTime               @default(now()) @db.DateTime(0)
  periodos                                        periodos               @relation(fields: [id_academic_periods], references: [periodo_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ag_period")
  usuarios_academic_grades_id_userTousuarios      usuarios               @relation("academic_grades_id_userTousuarios", fields: [id_user], references: [usuario_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ag_user")
  usuarios_academic_grades_validated_byTousuarios usuarios?              @relation("academic_grades_validated_byTousuarios", fields: [validated_by], references: [usuario_id], onUpdate: NoAction, map: "fk_ag_validator")

  @@unique([module, id_user, id_academic_periods], map: "uq_module_user_period")
  @@index([validated_by], map: "fk_ag_validator")
  @@index([id_academic_periods], map: "idx_period")
  @@index([status], map: "idx_status")
  @@index([id_user], map: "idx_user")
}

model app_settings {
  setting_key   String @id @db.VarChar(100)
  setting_value String @db.Text
}

model uic_topics {
  id                                     Int               @id @default(autoincrement())
  id_user                                Int               @db.UnsignedInt
  id_academic_periods                    Int               @db.UnsignedInt
  career                                 String            @db.VarChar(150)
  topic                                  String            @db.VarChar(300)
  id_tutor                               Int               @db.UnsignedInt
  submitted_at                           DateTime          @default(now()) @db.DateTime(0)
  updated_at                             DateTime          @default(now()) @db.DateTime(0)
  status                                 uic_topics_status @default(pending)
  periodos                               periodos          @relation(fields: [id_academic_periods], references: [periodo_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_uic_topics_period")
  usuarios_uic_topics_id_tutorTousuarios usuarios          @relation("uic_topics_id_tutorTousuarios", fields: [id_tutor], references: [usuario_id], onUpdate: Restrict, map: "fk_uic_topics_tutor")
  usuarios_uic_topics_id_userTousuarios  usuarios          @relation("uic_topics_id_userTousuarios", fields: [id_user], references: [usuario_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_uic_topics_user")

  @@unique([id_user, id_academic_periods], map: "uq_user_period")
  @@index([id_academic_periods], map: "fk_uic_topics_period")
  @@index([id_tutor], map: "fk_uic_topics_tutor")
}

model veedor_assignments {
  id                  Int      @id @default(autoincrement()) @db.UnsignedInt
  id_academic_periods Int      @db.UnsignedInt
  id_career           Int      @db.UnsignedInt
  id_user             Int      @db.UnsignedInt
  created_at          DateTime @default(now()) @db.DateTime(0)
  periodos            periodos @relation(fields: [id_academic_periods], references: [periodo_id], onUpdate: NoAction, map: "fk_veedor_period")
  usuarios            usuarios @relation(fields: [id_user], references: [usuario_id], onUpdate: NoAction, map: "fk_veedor_user")

  @@unique([id_academic_periods, id_career, id_user], map: "uq_veedor_period_career_user")
  @@index([id_career], map: "idx_veedor_career")
  @@index([id_academic_periods], map: "idx_veedor_period")
  @@index([id_user], map: "idx_veedor_user")
}

enum procesos_validaciones_proceso {
  tesoreria_aranceles
  secretaria_promedios
}

enum periodos_estado {
  activo
  inactivo
  cerrado
}

enum procesos_validaciones_estado {
  pending
  approved
  rejected
}

enum complexivo_asistencias_estado {
  presente
  ausente
  justificado
}

enum cronogramas_modalidad {
  UIC
  EXAMEN_COMPLEXIVO @map("EXAMEN COMPLEXIVO")
}

enum uic_tribunal_miembros_rol_tribunal {
  miembro_1
  miembro_2
  miembro_3
}

enum documentos_tipo {
  comprobante_certificados
  comprobante_titulacion
  comprobante_acta_grado
  solicitud
  oficio
  uic_final
  uic_acta_tribunal
  cert_tesoreria
  cert_secretaria
  cert_vinculacion
  cert_ingles
  cert_practicas
}

enum modalidades_elegidas_modalidad {
  UIC
  EXAMEN_COMPLEXIVO
}

enum academic_grades_module {
  english
  vinculacion
  practicas
}

enum academic_grades_status {
  saved
  validated
}

enum uic_topics_status {
  pending
  approved
  rejected
}

enum documentos_estado {
  en_revision
  aprobado
  rechazado
  pendiente_pago
  finalizado
}
